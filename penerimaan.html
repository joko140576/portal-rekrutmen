<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Database Pegawai | Google Spreadsheet</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
  background: linear-gradient(135deg,#eef4ff,#f8f9fa);
  min-height:100vh;
}

.card{
  border:none;
  border-radius:16px;
  box-shadow:0 12px 25px rgba(0,0,0,.08);
}

.card-header{
  background: linear-gradient(135deg,#0d6efd,#0b5ed7);
  color:white;
  border-radius:16px 16px 0 0;
}

.table thead th{
  text-align:center;
  vertical-align:middle;
}

.table tbody td{
  vertical-align:middle;
}

.modal-content{
  border-radius:16px;
}

.form-control{
  border-radius:10px;
}

.btn{
  border-radius:10px;
}
</style>
</head>

<body>

<div class="container py-5">

  <!-- CARD -->
  <div class="card">

    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-database-fill"></i> Database Pegawai
      </h5>

      <button class="btn btn-light btn-sm fw-semibold" data-bs-toggle="modal" data-bs-target="#modalTambah">
        <i class="bi bi-plus-circle-fill text-primary"></i> Tambah Data
      </button>
    </div>

    <div class="card-body">

      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-primary">
            <tr>
              <th><i class="bi bi-person"></i> Nama</th>
              <th><i class="bi bi-geo-alt"></i> Tempat Lahir</th>
              <th><i class="bi bi-calendar-event"></i> Tanggal Lahir</th>
              <th><i class="bi bi-house"></i> Domisili</th>
              <th><i class="bi bi-mortarboard"></i> Pendidikan</th>
              <th><i class="bi bi-telephone"></i> No Telp</th>
              <th><i class="bi bi-briefcase"></i> Jabatan</th>
            </tr>
          </thead>
          <tbody id="dataTable">
            <tr>
              <td colspan="7" class="text-center text-muted">
                <i class="bi bi-arrow-repeat"></i> Memuat data...
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>

</div>

<!-- MODAL -->
<div class="modal fade" id="modalTambah">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-person-plus-fill"></i> Tambah Data Pegawai
        </h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nama</label>
            <input class="form-control" id="nama">
          </div>
          <div class="col-md-6">
            <label class="form-label">Tempat Lahir</label>
            <input class="form-control" id="tempat">
          </div>
          <div class="col-md-6">
            <label class="form-label">Tanggal Lahir</label>
            <input type="date" class="form-control" id="tanggal">
          </div>
          <div class="col-md-6">
            <label class="form-label">Domisili</label>
            <input class="form-control" id="domisili">
          </div>
          <div class="col-md-6">
            <label class="form-label">Pendidikan</label>
            <input class="form-control" id="pendidikan">
          </div>
          <div class="col-md-6">
            <label class="form-label">Nomor Telp</label>
            <input class="form-control" id="telp">
          </div>
          <div class="col-md-12">
            <label class="form-label">Jabatan</label>
            <input class="form-control" id="jabatan">
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-success px-4" id="btnSimpan" onclick="simpanData()">
          <span id="btnText"><i class="bi bi-save"></i> Simpan</span>
          <span id="btnLoading" class="spinner-border spinner-border-sm d-none"></span>
        </button>
      </div>

    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbzjKdBH2RwU5m4rw2OStr51whjC8Y0py6raR_fhDRl7zRQ54H50R5VjaDlZ2VVJl6cwCA/exec";


document.addEventListener("DOMContentLoaded", loadData);

/* =========================
   LOAD DATA (GET)
========================= */
function loadData() {
  fetch(API + "?action=getData")
    .then(res => res.json())
    .then(data => {
      let html = "";
      data.forEach(row => {
        html += `
          <tr>
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[3]}</td>
            <td>${row[4]}</td>
            <td>${row[5]}</td>
            <td>${row[6]}</td>
          </tr>
        `;
      });
      document.getElementById("dataTable").innerHTML = html;
    });
}

/* =========================
   SIMPAN DATA (POST) â€“ CORS SAFE
========================= */
function simpanData() {
  setLoading(true);

  const formData = new FormData();
  formData.append("nama", nama.value);
  formData.append("tempat", tempat.value);
  formData.append("tanggal", tanggal.value);
  formData.append("domisili", domisili.value);
  formData.append("pendidikan", pendidikan.value);
  formData.append("telp", telp.value);
  formData.append("jabatan", jabatan.value);

  bootstrap.Modal.getInstance(
    document.getElementById('modalTambah')
  ).hide();

  fetch(API, {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(() => loadData())
  .finally(() => {
    setLoading(false);
    document.querySelectorAll("#modalTambah input").forEach(i => i.value = "");
  });
}

/* =========================
   LOADING BUTTON
========================= */
function setLoading(isLoading) {
  const btn = document.getElementById("btnSimpan");
  const text = document.getElementById("btnText");
  const loading = document.getElementById("btnLoading");

  btn.disabled = isLoading;
  text.classList.toggle("d-none", isLoading);
  loading.classList.toggle("d-none", !isLoading);
}
</script>

</body>
</html>
