<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>CRUD Google Spreadsheet</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container mt-4">
  <h3 class="mb-3">Data Pegawai</h3>

  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalTambah">
    + Tambah Data
  </button>

  <table class="table table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Nama</th>
        <th>Tempat Lahir</th>
        <th>Tanggal Lahir</th>
        <th>Domisili</th>
        <th>Pendidikan</th>
        <th>No Telp</th>
        <th>Jabatan</th>
      </tr>
    </thead>
    <tbody id="dataTable"></tbody>
  </table>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalTambah">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5>Tambah Data</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input class="form-control mb-2" id="nama" placeholder="Nama">
        <input class="form-control mb-2" id="tempat" placeholder="Tempat Lahir">
        <input type="date" class="form-control mb-2" id="tanggal">
        <input class="form-control mb-2" id="domisili" placeholder="Domisili">
        <input class="form-control mb-2" id="pendidikan" placeholder="Pendidikan">
        <input class="form-control mb-2" id="telp" placeholder="Nomor Telp">
        <input class="form-control mb-2" id="jabatan" placeholder="Jabatan">
      </div>

      <div class="modal-footer">
        <button class="btn btn-success" id="btnSimpan" onclick="simpanData()">
          <span id="btnText">Simpan</span>
          <span id="btnLoading" class="spinner-border spinner-border-sm d-none"></span>
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API = "https://script.google.com/macros/s/AKfycbzakarKltA9ME9D0CdQHRFFUtcrdWJolR0NYH5IvABrMIEZgQiiVff4Kj9k2WYHBWlEmg/exec";

document.addEventListener("DOMContentLoaded", loadData);

function loadData() {
  fetch(API + "?action=getData")
    .then(res => res.json())
    .then(data => {
      let html = "";
      data.forEach(row => {
        html += `
          <tr>
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[3]}</td>
            <td>${row[4]}</td>
            <td>${row[5]}</td>
            <td>${row[6]}</td>
          </tr>
        `;
      });
      document.getElementById("dataTable").innerHTML = html;
    });
}

function simpanData() {
  setLoading(true);

  const data = {
    nama: nama.value,
    tempat: tempat.value,
    tanggal: tanggal.value,
    domisili: domisili.value,
    pendidikan: pendidikan.value,
    telp: telp.value,
    jabatan: jabatan.value
  };

  // Modal ditutup LANGSUNG agar UI responsif
  bootstrap.Modal.getInstance(
    document.getElementById('modalTambah')
  ).hide();

  fetch(API, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(() => {
    loadData();
  })
  .finally(() => {
    setLoading(false);
    document.querySelectorAll("#modalTambah input").forEach(i => i.value = "");
  });
}

function setLoading(isLoading) {
  const btn = document.getElementById("btnSimpan");
  const text = document.getElementById("btnText");
  const loading = document.getElementById("btnLoading");

  if (isLoading) {
    btn.disabled = true;
    text.classList.add("d-none");
    loading.classList.remove("d-none");
  } else {
    btn.disabled = false;
    text.classList.remove("d-none");
    loading.classList.add("d-none");
  }
}
</script>

</body>
</html>
